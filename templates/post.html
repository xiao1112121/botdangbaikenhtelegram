<!doctype html>
<html lang="vi">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Đăng bài</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">Dashboard</a>
      </div>
    </nav>
    <div class="container">
      <h3>📝 Đăng bài lên kênh</h3>
      <div class="mb-3">
        <label class="form-label" for="content">Nội dung</label>
        <textarea id="content" class="form-control" rows="6" placeholder="Nhập nội dung... hỗ trợ shortcode [fire] → 🔥"></textarea>
      </div>
      <div class="mb-3">
        <label class="form-label" for="channelSelect">Chọn kênh</label>
        <select id="channelSelect" class="form-select" multiple size="6">
          {% for ch in channels %}
            <option value="{{ ch.id }}">{{ ch.name }} ({{ ch.id }})</option>
          {% endfor %}
        </select>
        <div class="form-text">Giữ Ctrl (Windows) hoặc ⌘ (Mac) để chọn nhiều kênh</div>
      </div>
      <button class="btn btn-success" onclick="sendPost()">🚀 Gửi bài</button>
      <div id="result" class="mt-3"></div>
    </div>

    <script>
      async function sendPost(){
        const content = document.getElementById('content').value;
        const select = document.getElementById('channelSelect');
        const channels = Array.from(select.selectedOptions).map(o=>o.value);
        if(!content){alert('Vui lòng nhập nội dung!');return;}
        if(channels.length===0){alert('Chọn ít nhất một kênh');return;}
        const res = await fetch('/post/send',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({content:content,channels:channels})});
        const data = await res.json();
        document.getElementById('result').innerHTML = `<pre>${JSON.stringify(data,null,2)}</pre>`;
      }
    </script>
  </body>
</html> 